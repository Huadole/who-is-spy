<!DOCTYPE html>
<html lang="zh-tw">
<head>
<meta charset="UTF-8">
<title>!! ES 誰是臥底 ES !!</title>
<style>
  table, th, td {
    border: 0px solid black;
    border-collapse: separate;
    border-spacing: 7px;
  }
  th, td {
    padding: 2px;
    text-align: center;
	height: 20px;
	width: 35px;
  }
  .color-lump {
    width: 80px;
    height: 40px;
  }
  .img-row {
    width: 300px;
    height: 375px;
  }
  button {
    width: 120px;
    height: 40px;
  }
</style>
</head>
<body>
	<center>
		<div class="color-lump" id="lead"></div>
		<table>
			<tr>
				<td><div id="table-container_0">牌庫</div></td>
				<td><div id="table-container_1">User1</div></td>
				<td><div id="table-container_2">User2</div></td>
			</tr>
			<tr>
				<td>
				<div>
					<button id="regen" onclick="Init()">Re-gen</button>
					<button id="get_ans1" onclick="Show_User(1)">User1</button><br>
					<button id="mode_set" onclick="ChangeMode()">Mode</button>
					<button id="get_ans2" onclick="Show_User(2)">User2</button><br><br>
					<text id="mode_text"></text>
					<text id="debug_str"></text>
				</div>
				</td>
				<td>
					<text>User2 Answer</text>
					<div id="ans2"><img id="img_ans1"></img></div>
				</td>
				<td>
					<text>User1 Answer</text>
					<div id="ans1"><img id="img_ans2"></img></div>
				</td>
			</tr>
		</table>
		<script>
		

		
		
		var idCounter = 1;         // Default=1~24, Usser1=25~48, User2=49~72
		var mode = 2;              // Set as default Mode=0
		var mode_num = 3;
		var round_row = 4;
		var round_col = 6;
		var total_img_num = 54;
		var used_img_num = 0;
		var user1_img = [];
		var user2_img = [];
		var user_show_en = [false, false];
		var user_ans_img_idx = [0, 0];
		var path_container = [];
		var sub_path = [];
		var img_size = 70;
		let cnt;
		var debug_str = "";
		
		
		
		
		function createTable(idx) 
		{
			if (idx == 0) var container = document.getElementById('table-container_0');
			else if (idx == 1) var container = document.getElementById('table-container_1');
			else if (idx == 2) var container = document.getElementById('table-container_2');
			var table = document.createElement('table');

			for (var i = 0; i < round_col; i++) 
			{
				var tr = document.createElement('tr');
				for (var j = 0; j < round_row; j++) 
				{
					var td = document.createElement('td');
					td.id = idCounter;  // 設定每個單元格的 ID
					//td.textContent = idCounter;  // 顯示 ID 編號
					var img = document.createElement('img');
					img.id = "img"+String(idCounter);
					td.appendChild(img);
					tr.appendChild(td);
					idCounter++;
				}
				table.appendChild(tr);
			}

			container.appendChild(table);
		}

		function InsertImg(idx) 
		{	
			if (idx == 0) var target_arr = sub_path;
			else if (idx == 1) var target_arr = user1_img;
			else if (idx == 2) var target_arr = user2_img;

			for (cnt = 0; cnt < (round_row*round_col) ; cnt++) 
			{
				var img_id_str = "img" + String((cnt+1)+(idx*(round_row*round_col)));
				//debug_str += img_id_str + ", ";
				//document.getElementById("debug_str").innerHTML = debug_str;
				
				var table_block = document.getElementById(img_id_str);
				//table_block.textContent = target_arr[cnt];
				table_block.src = target_arr[cnt];
				table_block.width = img_size;
				table_block.height = img_size;
			}
			//debug_str += "<br>";
			//document.getElementById("debug_str").innerHTML = debug_str;
			
			if (idx != 0)
			{
				var ans_idx = user_ans_img_idx[idx-1];
				img_id_str = "img_ans" + String(idx);
				
				var ans_block = document.getElementById(img_id_str);
				ans_block.src = target_arr[ans_idx];
				ans_block.width = img_size;
				ans_block.height = img_size;
			}
		}
		
		function UnImg(idx) 
		{
			for (cnt = 0; cnt < (round_row*round_col) ; cnt++) 
			{
				var img_id_str = "img" + String((cnt+1)+(idx*(round_row*round_col)));
				//debug_str += img_id_str + ", ";
				//document.getElementById("debug_str").innerHTML = debug_str;
				
				var table_block = document.getElementById(img_id_str);
				//table_block.textContent = target_arr[cnt];
				table_block.src = "";
				table_block.width = img_size;
				table_block.height = img_size;
			}
			//debug_str += "<br>";
			//document.getElementById("debug_str").innerHTML = debug_str;
			
			if (idx != 0)
			{
				var ans_idx = user_ans_img_idx[idx-1];
				img_id_str = "img_ans" + String(idx);
				
				var ans_block = document.getElementById(img_id_str);
				ans_block.src = "";
				ans_block.width = img_size;
				ans_block.height = img_size;
			}
		}
		
		function Show_User(idx)
		{
			var flag = user_show_en[idx-1]; // idx=0 is user1, idx=1 is user2
			
			if (flag == false)
			{
				InsertImg(idx);
				user_show_en[idx-1] = true;
			}
			else
			{
				UnImg(idx);
				user_show_en[idx-1] = false;
			}
		}
		
		function ChangeMode()
		{
			var mode_str = "";
			
			mode = (mode+1)%mode_num;
			
			// Update mode string
			mode_str += "Mode = " + String(mode+1);
			if (mode == 0) mode_str += " (ES!)<br>";
			else if (mode == 1) mode_str += " (ES! + ES!!一周目)<br>";
			else if (mode == 2) mode_str += " (ES! + ES!!一周目+二周目)<br>";
			
			// Update used image num
			if (mode == 0) used_img_num = 41;
			else if (mode == 1) used_img_num = 49;
			else if (mode == 2) used_img_num = 54;
			
			mode_str += "Total num = " + String(used_img_num);
			document.getElementById("mode_text").innerHTML = mode_str;
			Init();
		}		

		// Generate image path
		function getImagePath() 
		{	
			for (cnt = 1; cnt <= total_img_num ; cnt ++)
			{
				path_container.push("./images/"+String(cnt)+".jpg");
			}
		}
		
		function GetAns(idx)
		{
			if (idx != 0)
			{
				// Get random index (0~24)
				user_ans_img_idx[idx-1] = Math.floor(Math.random() * (round_row*round_col));
			}
		}
		
		// Get random set 
		function Init()
		{	
			// Initial 
			sub_path = [];
			user1_img = [];
			user2_img = [];
			UnImg(1);
			UnImg(2);
			for (cnt = 0; cnt <= 2 ; cnt ++) user_show_en[cnt] = false;
			for (cnt = 0; cnt <= 2 ; cnt ++) user_ans_img_idx[cnt] = 0;
			
			// Random order of images
			sub_path = path_container.slice(0, used_img_num);
			sub_path.sort(() => Math.random() - Math.random());
			user1_img = sub_path.slice(0, (round_row*round_col));
			user2_img = sub_path.slice(0, (round_row*round_col));
			user1_img.sort(() => Math.random() - Math.random());
			user2_img.sort(() => Math.random() - Math.random());
			
			InsertImg(0);
			GetAns(1);
			GetAns(2);
			
		}
		
		createTable(0);
		createTable(1);
		createTable(2);
		ChangeMode();

		getImagePath();
		Init();		
				
		
		</script>

	</center>
</body>
</html>
